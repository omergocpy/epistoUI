import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
// src/pages/scanner/Scanner.tsx
import { useEffect, useState } from 'react';
import HeaderDashboard from '../../../components/HeaderDashboard';
import FooterDashboard from '../../../components/FooterDashboard';
import { useNavigate } from 'react-router-dom';
import { SubmissionControllerApi, VirtualMachineControllerApi } from '../../../api';
import axios from 'axios';
const Scanner = () => {
    const navigate = useNavigate();
    const [selectedMachine, setSelectedMachine] = useState('SB_cuckoo1');
    const [machines, setMachines] = useState([]);
    const [scans, setScans] = useState([]);
    const [isModalOpen, setIsModalOpen] = useState(false);
    const [selectedScan, setSelectedScan] = useState(null);
    const [selectedFile, setSelectedFile] = useState(null);
    const [scanType, setScanType] = useState('dynamic');
    const [uploadResponse, setUploadResponse] = useState(null);
    // Makine listesini çekiyoruz.
    useEffect(() => {
        const vmApi = new VirtualMachineControllerApi();
        vmApi.getMachines()
            .then((response) => {
            // API yanıtı { data: { data: [...] } } şeklinde ise:
            setMachines((response.data.data.data));
        })
            .catch((err) => {
            console.error("Machine API hatası:", err);
        });
    }, []);
    // Tarama geçmişini çekiyoruz ve "Failed" olanları filtreliyoruz.
    useEffect(() => {
        const submissionApi = new SubmissionControllerApi();
        submissionApi.getComplatedSubmissions()
            .then((response) => {
            const data = response.data.data || [];
            const filteredScans = data.filter((scan) => scan.malstatus !== "Failed");
            setScans(filteredScans);
        })
            .catch((err) => {
            console.error("Submission API hatası:", err);
        });
    }, []);
    // Modal açma/kapama fonksiyonları
    const openModal = (scan) => {
        setSelectedScan(scan);
        setIsModalOpen(true);
    };
    const closeModal = () => {
        setSelectedScan(null);
        setIsModalOpen(false);
    };
    // Tarama listesindeki satıra tıklandığında id'yi route parametresi olarak gönderiyoruz.
    const handleDetailsClick = (id) => {
        navigate(`/scanner-details/${id}`);
    };
    const handleUpload = () => {
        if (!selectedFile) {
            alert("Lütfen bir dosya seçin");
            return;
        }
        const formData = new FormData();
        formData.append("file", selectedFile);
        // API URL'si ve endpoint belirleniyor.
        const baseUrl = 'http://45.80.174.126:18081';
        const endpoint = scanType === "dynamic"
            ? `${baseUrl}/api/submit?machine=${selectedMachine}`
            : `${baseUrl}/api/submit/staticAnalyze?machine=${selectedMachine}`;
        // Axios ile dosya yükleme isteği yapıyoruz.
        axios.post(endpoint, formData, {
            headers: {
                // Content-Type belirtmeyin, tarayıcı otomatik olarak multipart/form-data ayarlar.
                'Accept': 'application/json, text/plain, */*',
                'Accept-Language': 'en-US,en;q=0.9',
                'Connection': 'keep-alive',
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 OPR/116.0.0.0'
            }
        })
            .then(response => {
            console.log(scanType === "dynamic"
                ? "Dinamik tarama dosya yükleme başarılı"
                : "Statik tarama dosya yükleme başarılı", response.data);
            // API'den gelen mesajı state'e atıyoruz.
            setUploadResponse(response.data.message);
        })
            .catch(err => {
            console.error(scanType === "dynamic"
                ? "Dinamik tarama dosya yükleme hatası"
                : "Statik tarama dosya yükleme hatası", err);
            setUploadResponse("Dosya yüklemede hata oluştu.");
        });
    };
    return (_jsxs("div", { className: "min-h-screen bg-[#231010] text-white", style: { fontFamily: '"Space Grotesk", "Noto Sans", sans-serif' }, children: [_jsx(HeaderDashboard, {}), _jsxs("div", { className: "px-40 flex flex-1 justify-center py-5", children: [_jsxs("div", { className: "layout-content-container flex flex-col max-w-[960px] flex-1", children: [_jsxs("div", { className: "flex flex-col gap-6 md:flex-row", children: [_jsxs("div", { className: "md:w-1/2 p-4", children: [_jsx("h3", { className: "text-white text-lg font-bold leading-tight tracking-[-0.015em] pb-2", children: "Dosya Y\u00FCkle" }), _jsx("p", { className: "text-white text-base font-normal leading-normal pb-3", children: "Bir dosyay\u0131 s\u00FCr\u00FCkleyip b\u0131rak\u0131n veya y\u00FCklemek i\u00E7in t\u0131klay\u0131n." }), _jsxs("div", { className: "relative flex items-center justify-center w-full h-40 rounded-xl border-2 border-dashed border-[#683131] bg-[#492222] text-white", children: [_jsx("p", { className: "pointer-events-none text-sm font-medium", children: "Dosyalar\u0131n\u0131z\u0131 buraya b\u0131rak\u0131n" }), _jsx("input", { type: "file", className: "absolute inset-0 opacity-0 cursor-pointer", multiple: true, accept: "*/*", onChange: (e) => {
                                                            if (e.target.files && e.target.files.length > 0) {
                                                                // Sadece ilk dosyayı alıyoruz. (Gerekirse çoklu dosya desteğini ekleyebilirsiniz.)
                                                                setSelectedFile(e.target.files[0]);
                                                            }
                                                        } })] })] }), _jsxs("div", { className: "md:w-1/2 p-4", children: [_jsx("h3", { className: "text-white text-lg font-bold leading-tight tracking-[-0.015em] pb-2", children: "Tarama Se\u00E7enekleri" }), _jsx("p", { className: "text-white text-base font-normal leading-normal pb-3", children: "Tarama T\u00FCr\u00FCn\u00FC Se\u00E7iniz." }), _jsxs("div", { className: "flex flex-col gap-4", children: [_jsxs("label", { className: "flex items-center gap-4 rounded-xl border border-solid border-[#683131] p-6 bg-gradient-to-r from-[#2d2d2d] to-[#492222] shadow-lg transition-transform transform hover:scale-105", children: [_jsx("input", { type: "radio", name: "taramaSecenekleri", className: "hidden peer" }), _jsx("div", { className: "w-5 h-5 rounded-full border-2 border-[#683131] flex items-center justify-center peer-checked:border-[#f20d0d]", children: _jsx("div", { className: "w-3 h-3 rounded-full bg-[#f20d0d] hidden peer-checked:block" }) }), _jsxs("div", { className: "flex flex-col", children: [_jsx("p", { className: "text-white text-sm font-medium", children: "Dinamik Tarama" }), _jsx("p", { className: "text-gray-300 text-xs", children: "Ger\u00E7ek zamanl\u0131 analiz" })] })] }), _jsxs("label", { className: "flex items-center gap-4 rounded-xl border border-solid border-[#683131] p-6 bg-gradient-to-r from-[#2d2d2d] to-[#492222] shadow-lg transition-transform transform hover:scale-105", children: [_jsx("input", { type: "radio", name: "taramaSecenekleri", className: "hidden peer" }), _jsx("div", { className: "w-5 h-5 rounded-full border-2 border-[#683131] flex items-center justify-center peer-checked:border-[#f20d0d]", children: _jsx("div", { className: "w-3 h-3 rounded-full bg-[#f20d0d] hidden peer-checked:block" }) }), _jsxs("div", { className: "flex flex-col", children: [_jsx("p", { className: "text-white text-sm font-medium", children: "Statik Tarama" }), _jsx("p", { className: "text-gray-300 text-xs", children: "Ger\u00E7ek zamanl\u0131 analiz" })] })] })] })] })] }), uploadResponse && (_jsx("div", { className: "mt-4 p-3 bg-green-800 rounded", children: _jsx("p", { className: "text-white", children: uploadResponse }) })), _jsx("h3", { className: "text-white text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4", children: "Makina Se\u00E7imi" }), _jsx("div", { className: "flex flex-wrap gap-6 mt-6", children: machines.map((machine) => (_jsxs("div", { className: `flex w-full h-32 p-4 rounded-xl border-2 border-[#683131] transition-all duration-300 ease-in-out ${selectedMachine === machine.name ? 'bg-[#f20d0d]' : 'bg-[#492222]'} hover:scale-105 hover:bg-[#6f2e2e]`, onClick: () => setSelectedMachine(machine.name), children: [_jsx("div", { className: "w-full md:w-1/4 h-full", children: _jsx("img", { src: "https://i0.wp.com/saitorhan.com/wp-content/uploads/2021/07/Windows.jpg?fit=740%2C479&ssl=1", alt: `${machine.label} image`, className: "w-full h-full object-cover rounded-xl" }) }), _jsxs("div", { className: "flex flex-col justify-between w-full md:w-3/4 pl-4", children: [_jsx("p", { className: "text-white text-lg font-bold", children: machine.platform }), _jsxs("p", { className: "text-white text-sm", children: ["Durum: ", machine.status] }), _jsxs("p", { className: "text-white text-sm", children: ["Mimari: ", machine.arch] }), _jsxs("p", { className: "text-white text-sm", children: ["A\u011F Aray\u00FCz\u00FC: ", machine.label] })] })] }, machine.id))) }), _jsx("div", { className: "w-full mt-5 mb-5", children: _jsx("button", { onClick: handleUpload, className: "flex w-full h-10 px-4 bg-[#f20d0d] text-white text-sm font-bold leading-normal tracking-[0.015em] items-center justify-center overflow-hidden rounded-xl", children: _jsx("span", { className: "truncate", children: "Analizi Ba\u015Flat" }) }) }), _jsx("hr", {}), _jsx("h3", { className: "text-white text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4", children: "Tarama Ge\u00E7mi\u015Fi" }), _jsx("div", { className: "px-4 py-3", children: _jsx("label", { className: "flex flex-col min-w-40 h-12 w-full", children: _jsxs("div", { className: "flex w-full flex-1 items-stretch rounded-xl h-full", children: [_jsx("div", { className: "text-[#cb9090] flex border-none bg-[#492222] items-center justify-center pl-4 rounded-l-xl", children: _jsx("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24px", height: "24px", fill: "currentColor", viewBox: "0 0 256 256", children: _jsx("path", { d: "M229.66,218.34l-50.07-50.06a88.11,88.11,0,1,0-11.31,11.31l50.06,50.07a8,8,0,0,0,11.32-11.32ZM40,112a72,72,0,1,1,72,72A72.08,72.08,0,0,1,40,112Z" }) }) }), _jsx("input", { placeholder: "Hash ile Ara", className: "form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-white focus:outline-0 focus:ring-0 border-none bg-[#492222] focus:border-none h-full placeholder:text-[#cb9090] px-4 rounded-l-none border-l-0 pl-2 text-base font-normal leading-normal" })] }) }) }), _jsx("div", { className: "px-4 py-3", children: _jsxs("div", { className: "px-4 py-3", children: [_jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "min-w-full bg-[#231010] text-white", children: [_jsx("thead", { className: "bg-[#341818]", children: _jsxs("tr", { children: [_jsx("th", { className: "px-4 py-2", children: "Task ID" }), _jsx("th", { className: "px-4 py-2", children: "Category" }), _jsx("th", { className: "px-4 py-2", children: "Platform" }), _jsx("th", { className: "px-4 py-2", children: "MalScore" }), _jsx("th", { className: "px-4 py-2", children: "MalStatus" }), _jsx("th", { className: "px-4 py-2", children: "Status" }), _jsx("th", { className: "px-4 py-2", children: "Actions" })] }) }), _jsx("tbody", { children: scans.map((item) => (_jsxs("tr", { className: "border-t border-[#683131]", children: [_jsx("td", { className: "px-4 py-2", children: item.capeTaskId }), _jsx("td", { className: "px-4 py-2", children: item.category || 'N/A' }), _jsx("td", { className: "px-4 py-2", children: item.platform || 'N/A' }), _jsx("td", { className: "px-4 py-2", children: item.malscore }), _jsx("td", { className: "px-4 py-2", children: item.malstatus || 'N/A' }), _jsx("td", { className: "px-4 py-2", children: item.status || 'N/A' }), _jsxs("td", { className: "px-4 py-2 space-x-2", children: [_jsx("button", { onClick: () => openModal(item), className: "bg-[#492222] text-white px-3 py-1 rounded hover:bg-[#333] transition", children: "More Details" }), _jsx("button", { onClick: () => handleDetailsClick(item.capeTaskId), className: "bg-[#f20d0d] text-white px-3 py-1 rounded hover:bg-[#d10c0c] transition", children: "Scan Details" })] })] }, item.id))) })] }) }), isModalOpen && selectedScan && (_jsx("div", { className: "fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50", children: _jsxs("div", { className: "bg-red-900 rounded-lg shadow-2xl w-11/12 md:w-3/4 lg:w-1/2 overflow-y-auto max-h-[90vh]", children: [_jsxs("div", { className: "flex items-center justify-between bg-red-700 p-4 rounded-t-lg", children: [_jsx("h2", { className: "text-white text-xl font-bold", children: "Additional Scan Details" }), _jsx("button", { onClick: closeModal, className: "text-white text-2xl focus:outline-none", children: "\u00D7" })] }), _jsxs("div", { className: "p-6 text-white space-y-4", children: [_jsxs("div", { children: [_jsx("strong", { children: "File Path:" }), _jsx("p", { className: "truncate", children: selectedScan.filePath || 'N/A' })] }), _jsxs("div", { children: [_jsx("strong", { children: "File Hash:" }), _jsx("p", { className: "truncate", children: selectedScan.fileHash || 'N/A' })] }), _jsxs("div", { className: "grid grid-cols-2 gap-4", children: [_jsxs("div", { children: [_jsx("strong", { children: "File Extension:" }), _jsx("p", { children: selectedScan.fileExtension || 'N/A' })] }), _jsxs("div", { children: [_jsx("strong", { children: "Create Date:" }), _jsx("p", { children: selectedScan.createDate || 'N/A' })] }), _jsxs("div", { children: [_jsx("strong", { children: "Version:" }), _jsx("p", { children: selectedScan.version || 'N/A' })] }), _jsxs("div", { children: [_jsx("strong", { children: "Started:" }), _jsx("p", { children: selectedScan.started || 'N/A' })] }), _jsxs("div", { children: [_jsx("strong", { children: "Ended:" }), _jsx("p", { children: selectedScan.ended || 'N/A' })] }), _jsxs("div", { children: [_jsx("strong", { children: "Duration:" }), _jsx("p", { children: selectedScan.duration || 'N/A' })] }), _jsxs("div", { children: [_jsx("strong", { children: "Package Name:" }), _jsx("p", { children: selectedScan.packageName || 'N/A' })] }), _jsxs("div", { children: [_jsx("strong", { children: "Error:" }), _jsx("p", { children: selectedScan.error ? 'Yes' : 'No' })] }), _jsxs("div", { children: [_jsx("strong", { children: "Downloaded Screenshots:" }), _jsx("p", { children: selectedScan.dowloadedScreenShots ? 'Yes' : 'No' })] })] })] })] }) }))] }) })] }), _jsx("div", { className: "layout-content-container flex flex-col", children: _jsx("div", { className: "flex h-full min-h-[700px] flex-col justify-between bg-[#231010] p-4", children: _jsxs("div", { className: "flex flex-col gap-4", children: [_jsx("h1", { className: "text-white text-base font-medium leading-normal", children: "Tarama T\u00FCrleri" }), _jsxs("div", { className: "flex flex-col gap-2", children: [_jsxs("div", { className: "flex items-center gap-3 px-3 py-2", children: [_jsx("div", { className: "text-white", "data-icon": "House", "data-size": "24px", "data-weight": "regular", children: _jsx("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24px", height: "24px", fill: "currentColor", viewBox: "0 0 256 256", children: _jsx("path", { d: "M218.83,103.77l-80-75.48a1.14,1.14,0,0,1-.11-.11,16,16,0,0,0-21.53,0l-.11.11L37.17,103.77A16,16,0,0,0,32,115.55V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V160h32v48a16,16,0,0,0,16,16h48a16,16,0,0,0,16-16V115.55A16,16,0,0,0,218.83,103.77ZM208,208H160V160a16,16,0,0,0-16-16H112a16,16,0,0,0-16,16v48H48V115.55l.11-.1L128,40l79.9,75.43.11.1Z" }) }) }), _jsx("p", { className: "text-white text-sm font-medium leading-normal", children: "Dashboard" })] }), _jsxs("div", { className: "flex items-center gap-3 px-3 py-2 rounded-xl bg-[#492222]", children: [_jsx("div", { className: "text-white", "data-icon": "File", "data-size": "24px", "data-weight": "fill", children: _jsx("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24px", height: "24px", fill: "currentColor", viewBox: "0 0 256 256", children: _jsx("path", { d: "M213.66,82.34l-56-56A8,8,0,0,0,152,24H56A16,16,0,0,0,40,40V216a16,16,0,0,0,16,16H200a16,16,0,0,0,16-16V88A8,8,0,0,0,213.66,82.34ZM152,88V44l44,44Z" }) }) }), _jsx("p", { className: "text-white text-sm font-medium leading-normal", children: "Files" })] }), _jsxs("div", { className: "flex items-center gap-3 px-3 py-2", children: [_jsx("div", { className: "text-white", "data-icon": "Compass", "data-size": "24px", "data-weight": "regular", children: _jsx("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24px", height: "24px", fill: "currentColor", viewBox: "0 0 256 256", children: _jsx("path", { d: "M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216ZM172.42,72.84l-64,32a8.05,8.05,0,0,0-3.58,3.58l-32,64A8,8,0,0,0,80,184a8.1,8.1,0,0,0,3.58-.84l64-32a8.05,8.05,0,0,0,3.58-3.58l32-64a8,8,0,0,0-10.74-10.74ZM138,138,97.89,158.11,118,118l40.15-20.07Z" }) }) }), _jsx("p", { className: "text-white text-sm font-medium leading-normal", children: "Pcap" })] }), _jsxs("div", { className: "flex items-center gap-3 px-3 py-2", children: [_jsx("div", { className: "text-white", "data-icon": "Globe", "data-size": "24px", "data-weight": "regular", children: _jsx("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24px", height: "24px", fill: "currentColor", viewBox: "0 0 256 256", children: _jsx("path", { d: "M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM101.63,168h52.74C149,186.34,140,202.87,128,215.89,116,202.87,107,186.34,101.63,168ZM98,152a145.72,145.72,0,0,1,0-48h60a145.72,145.72,0,0,1,0,48ZM40,128a87.61,87.61,0,0,1,3.33-24H81.79a161.79,161.79,0,0,0,0,48H43.33A87.61,87.61,0,0,1,40,128ZM154.37,88H101.63C107,69.66,116,53.13,128,40.11,140,53.13,149,69.66,154.37,88Zm19.84,16h38.46a88.15,88.15,0,0,1,0,48H174.21a161.79,161.79,0,0,0,0-48Zm32.16-16H170.94a142.39,142.39,0,0,0-20.26-45A88.37,88.37,0,0,1,206.37,88ZM105.32,43A142.39,142.39,0,0,0,85.06,88H49.63A88.37,88.37,0,0,1,105.32,43ZM49.63,168H85.06a142.39,142.39,0,0,0,20.26,45A88.37,88.37,0,0,1,49.63,168Zm101.05,45a142.39,142.39,0,0,0,20.26-45h35.43A88.37,88.37,0,0,1,150.68,213Z" }) }) }), _jsx("p", { className: "text-white text-sm font-medium leading-normal", children: "URLs" })] }), _jsxs("div", { className: "flex items-center gap-3 px-3 py-2", children: [_jsx("div", { className: "text-white", "data-icon": "Hash", "data-size": "24px", "data-weight": "regular", children: _jsx("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24px", height: "24px", fill: "currentColor", viewBox: "0 0 256 256", children: _jsx("path", { d: "M224,88H175.4l8.47-46.57a8,8,0,0,0-15.74-2.86l-9,49.43H111.4l8.47-46.57a8,8,0,0,0-15.74-2.86L95.14,88H48a8,8,0,0,0,0,16H92.23L83.5,152H32a8,8,0,0,0,0,16H80.6l-8.47,46.57a8,8,0,0,0,6.44,9.3A7.79,7.79,0,0,0,80,224a8,8,0,0,0,7.86-6.57l9-49.43H144.6l-8.47,46.57a8,8,0,0,0,6.44,9.3A7.79,7.79,0,0,0,144,224a8,8,0,0,0,7.86-6.57l9-49.43H208a8,8,0,0,0,0-16H163.77l8.73-48H224a8,8,0,0,0,0-16Zm-76.5,64H99.77l8.73-48h47.73Z" }) }) }), _jsx("p", { className: "text-white text-sm font-medium leading-normal", children: "Hashes" })] }), _jsxs("div", { className: "flex items-center gap-3 px-3 py-2", children: [_jsx("div", { className: "text-white", "data-icon": "Pi", "data-size": "24px", "data-weight": "regular", children: _jsx("svg", { xmlns: "http://www.w3.org/2000/svg", width: "24px", height: "24px", fill: "currentColor", viewBox: "0 0 256 256", children: _jsx("path", { d: "M232,172a36,36,0,0,1-72,0V72H96V200a8,8,0,0,1-16,0V72H72a40,40,0,0,0-40,40,8,8,0,0,1-16,0A56.06,56.06,0,0,1,72,56H224a8,8,0,0,1,0,16H176V172a20,20,0,0,0,40,0,8,8,0,0,1,16,0Z" }) }) }), _jsx("p", { className: "text-white text-sm font-medium leading-normal", children: "IPs" })] })] })] }) }) })] }), _jsx(FooterDashboard, {})] }));
};
export default Scanner;
